/*! 808 2014-04-24 */
(function(){var a,b,c,d,e,f;a=$(window),e=Backbone.Model.extend({initialize:function(){return this.playing=0,this.on("change:playing",this.togglePlay),this.on("change:tempo",this.changeTempo),this.changeTempo(120)},togglePlay:function(){var b;return b=function(c){return function(){return setTimeout(function(){return a.trigger("beat",c.beat||0),c.beat++,16===c.beat&&(c.beat=0),c.playing?b():void 0},c.get("bpm"))}}(this),this.playing=!this.playing,this.playing?(this.beat=0,b()):void 0},changeTempo:function(a){this.set({bpm:6e4/a/4})}}),b=Backbone.Model.extend({initialize:function(b){return this.el=b.el,this.beats=[],this.$audio=$("<audio />"),this.set("active",this.el.hasClass("active")),this.$audio.attr("src",this.get("file")),this.on("change:knob1 change:knob2",this.setFile),this.on("change:isactive",this.onActiveToggle),this.on("change:step",this.onStepChange),a.on("beat",_.bind(this.onBeat,this)),this.setFile()},setFile:function(){var a,b,c,d;return d=function(a){switch(a){case 0:a="00";break;case 1:a="25";break;case 2:a="50";break;case 3:a="75";break;case 4:a="10";break;default:a=""}return a},a=d(this.get("knob1")),b=d(this.get("knob2")),c=""+a+b,this.$audio.attr("src","samples/"+this.id+c+".mp3")},onBeat:function(a,b){return $.inArray(b,this.beats)>=0?(this.$audio[0].currentTime=0,this.$audio[0].play()):void 0},onActiveToggle:function(a){var b;return b=this.get("active"),(b||a===this.id)&&(this.el.toggleClass("active",!b),this.set("active",!b)),a===this.id?this.setupBeats():void 0},onStepChange:function(a){return $.inArray(a,this.beats)>=0?this.beats=_.without(this.beats,a):this.beats.push(a)},setupBeats:function(){return $("#sequencer button").each(function(a){return function(b,c){var d;return d=$.inArray(b,a.beats)>=0,$(c).toggleClass("active",d)}}(this))}}),d=Backbone.Collection.extend({model:b}),c=Backbone.View.extend({el:$("#drum-machine"),events:{"change #tempo":"changeTempo","click .drum":"drumActiveToggle","click #controls button":"togglePlay","click #sequencer button":"sequencerToggle","change input[type=range]":"moveKnob"},initialize:function(){return this.tempo=new e,this.drums=new d,this.$el.find(".drum").each(_.bind(this.createDrum,this))},changeTempo:function(){var a;return a=+this.$el.find("#tempo").val(),this.tempo.trigger("change:tempo",a)},createDrum:function(a,b){var c,d,e;return c=$(b),d=c.find(".knob1"),e=c.find(".knob2"),this.drums.push([{el:c,id:c.attr("id"),vol:c.find(".vol"),knob1:+d.val(),knob2:+e.val()}])},togglePlay:function(){this.tempo.trigger("change:playing")},drumActiveToggle:function(a){var b,c;a.preventDefault(),b=$(a.target).closest(".drum"),b.hasClass("active")||(c=b.attr("id"),this.drums.each(function(a){return a.trigger("change:isactive",c)}))},sequencerToggle:function(a){var b,c,d,e;return b=$(a.target),e=b.index(),d=b.hasClass("active"),c=this.drums.where({active:!0})[0],c&&(b.toggleClass("active",!d),c.trigger("change:step",e)),a.preventDefault()},moveKnob:function(a){var b,c;return b=$(a.target),c=this.drums.where({active:!0})[0],c&&c.set(b.attr("name"),+b.val()),a.preventDefault()}}),f=new c}).call(this);